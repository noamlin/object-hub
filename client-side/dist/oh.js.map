{"version":3,"sources":["../../node_modules/proxserve/general-functions.js","functions.js","../../utils/variables.js","../../utils/globals.js","../../classes/oh/instances.js","../../utils/change-events.js","oh.js"],"names":["realtypeof","variable","rawType","Object","prototype","toString","call","substring","length","simpleCloneSet","WeakSet","simpleClone","obj","typeofobj","cloned","add","keys","key","has","i","console","warn","splitPath","path","resultsArr","tmp","char","push","evalPath","object","property","undefined","value","segments","Error","isObject","simpleDeepEqual","obj1","obj2","keys1","keys2","val1","val2","xorChanges","changes","matchAgainst","uniqueChanges","slice","changesLoop","againstChange","j","change","type","splice","str2VarName","id","acceptableChars","signs","$","_","digits","lowercase","a","b","c","d","e","f","g","h","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","uppercase","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","normalized","shuffle","arr","newArr","Math","floor","random","isNumeric","isNaN","module","exports","defaultBasePermission","permissionsKey","Symbol","for","path2nodeKey","forceEventChangeKey","proxy2instance","WeakMap","instance2proxy","set","proxy","instance","getInstance","get","getProxy","require","ohInstances","validChangeTypes","areValidChanges","Array","isArray","includes","hasOwnProperty","digest","oh","digested","isFirstIteration","filteredChanges","spreadedChanges","permission","permissionTree","requiresDifferentPermissions","currentPermission","compare","typeofchange","oldValue","innerChanges","OH_DEBUG","OH","domain","afterInitCallback","clientData","proxserveOptions","initiated","changesQueue","client","server","delay","strict","emitReference","socket","io","autoConnect","reconnection","query","data","JSON","stringify","on","Proxserve","onObjectChange","bind","updateObject","parts","currObj","shift","error","reason","concat","emit"],"mappings":"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","file":"oh.js","sourceRoot":"../src","sourcesContent":["/**\n * Copyright 2020 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\n/**\n * return a string representing the full type of the variable\n * @param {*} variable \n * @returns {String} - Object, Array, Number, String, Boolean, Null, Undefined, BigInt, Symbol, Date ...\n */\nexport function realtypeof(variable) {\n\tlet rawType = Object.prototype.toString.call(variable); //[object Object], [object Array], [object Number] ...\n\treturn rawType.substring(8, rawType.length - 1);\n}\n\n/**\n * recursively clones objects and array\n * @param {Proxy|Object|Array} proxy \n */\nlet simpleCloneSet = new WeakSet();\nexport function simpleClone(obj) {\n\tlet typeofobj = realtypeof(obj);\n\tlet cloned;\n\tif(typeofobj === 'Object') {\n\t\tsimpleCloneSet.add(obj);\n\t\tcloned = {};\n\t\tlet keys = Object.keys(obj);\n\t\tfor(let key of keys) {\n\t\t\tif(simpleCloneSet.has(obj[key])) {\n\t\t\t\tcloned[key] = obj[key];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcloned[key] = simpleClone(obj[key]);\n\t\t\t}\n\t\t}\n\t}\n\telse if(typeofobj === 'Array') {\n\t\tsimpleCloneSet.add(obj);\n\t\tcloned = [];\n\t\tfor(let i = 0; i < obj.length; i++) {\n\t\t\tif(simpleCloneSet.has(obj[i])) {\n\t\t\t\tcloned[i] = obj[i];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcloned[i] = simpleClone(obj[i]);\n\t\t\t}\n\t\t}\n\t}\n\telse { //hopefully a primitive\n\t\tcloned = obj;\n\n\t\tif(typeofobj !== 'Undefined' && typeofobj !== 'Null' && typeofobj !== 'Boolean' && typeofobj !== 'Number'\n\t\t&& typeofobj !== 'BigInt' && typeofobj !== 'String') {\n\t\t\tconsole.warn(`Can't clone a variable of type ${typeofobj}`);\n\t\t}\n\t}\n\n\treturn cloned;\n}\n\n/**\n * splits a path to an array of properties\n * (benchmarked and is faster than regex and split())\n * @param {String} path \n */\nexport function splitPath(path) {\n\tif(typeof path !== 'string' || path === '') {\n\t\treturn [];\n\t}\n\t\n\tlet i = 0;\n\tif(path[0] === '.' || path[0] === '[') {\n\t\ti = 1; //loop will skip over openning '.' or '['\n\t}\n\n\tvar resultsArr = [];\n\tvar tmp='';\n\tfor(; i < path.length; i++) {\n\t\tlet char = path[i];\n\t\tif(char === '.' || char === '[') {\n\t\t\tresultsArr.push(tmp);\n\t\t\ttmp = '';\n\t\t} else if(char !== ']') {\n\t\t\ttmp += char;\n\t\t}\n\t}\n\tif(tmp!=='') {\n\t\tresultsArr.push(tmp);\n\t}\n\treturn resultsArr;\n}\n\n/**\n * evaluate a long path and return the designated object and its referred property\n * @param {Object} obj\n * @param {String} path\n * @returns {Object} - returns {object, property, value}\n */\nexport function evalPath(obj, path) {\n\tif(path === '') {\n\t\treturn { object: obj, property: undefined, value: obj };\n\t}\n\n\tlet segments = splitPath(path);\n\tlet i;\n\tfor(i = 0; i <= segments.length - 2; i++) { //iterate until one before last property because they all must exist\n\t\tobj = obj[segments[i]];\n\t\tif(typeof obj === 'undefined') {\n\t\t\tthrow new Error(`Invalid path was given - \"${path}\"`);\n\t\t}\n\t}\n\treturn { object: obj, property: segments[i], value: obj[ segments[i] ] };\n}","/**\n * Copyright 2020 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nfunction isObject(obj) {\n\treturn (obj !== null && typeof obj === 'object');\n}\n\nexport function simpleDeepEqual(obj1, obj2) {\n\tif(obj1 === obj2) return true;\n\n\tif(!isObject(obj1) || !isObject(obj2)) return false;\n\n\tconst keys1 = Object.keys(obj1);\n\tconst keys2 = Object.keys(obj2);\n\n\tif (keys1.length !== keys2.length) {\n\t\treturn false;\n\t}\n\n\tfor(let key of keys1) {\n\t\tlet val1 = obj1[key];\n\t\tlet val2 = obj2[key];\n\n\t\tif(!simpleDeepEqual(val1, val2)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t\n\treturn true;\n}\n\n/**\n * match changes list against a secondary changes list and returns only the unique changes of the primary list\n * @param {Array.<Change>} changes\n * @param {Array.<Change>} matchAgainst\n */\nexport function xorChanges(changes, matchAgainst) {\n\tlet uniqueChanges = changes.slice();\n\n\tchangesLoop: for(let i = 0; i < matchAgainst.length; i++) {\n\t\tlet againstChange = matchAgainst[i];\n\t\tfor(let j = uniqueChanges.length - 1; j >= 0; j--) {\n\t\t\tlet change = uniqueChanges[j];\n\t\t\tif(change.type === againstChange.type && change.path === againstChange.path /*probably the same change*/\n\t\t\t&& (change.type === 'delete' || simpleDeepEqual(change.value, againstChange.value))) { //both are delete or both change to the same value\n\t\t\t\tuniqueChanges.splice(j, 1);\n\t\t\t\tcontinue changesLoop;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn uniqueChanges;\n}","/**\n * utilities for variables manipulations and type reading\n */\n\"use strict\";\n\nfunction str2VarName(id) {\n\tlet acceptableChars = {\n\t\tsigns: {$:1, _:1},\n\t\tdigits: {'0':1,'1':1,'2':1,'3':1,'4':1,'5':1,'6':1,'7':1,'8':1,'9':1},\n\t\tlowercase: {a:1,b:1,c:1,d:1,e:1,f:1,g:1,h:1,i:1,j:1,k:1,l:1,m:1,n:1,o:1,p:1,q:1,r:1,s:1,t:1,u:1,v:1,w:1,x:1,y:1,z:1},\n\t\tuppercase: {A:1,B:1,C:1,D:1,E:1,F:1,G:1,H:1,I:1,J:1,K:1,L:1,M:1,N:1,O:1,P:1,Q:1,R:1,S:1,T:1,U:1,V:1,W:1,X:1,Y:1,Z:1}\n\t};\n\n\tlet normalized = '';\n\n\tfor(let i = 0; i < id.length; i++) {\n\t\tif(id[i] in acceptableChars.signs || id[i] in acceptableChars.digits || id[i] in acceptableChars.lowercase || id[i] in acceptableChars.uppercase) {\n\t\t\tnormalized += id[i];\n\t\t}\n\t}\n\n\tif(normalized.length === 0 || normalized.substring(0,1) in acceptableChars.digits) {\n\t\tnormalized = '_' + normalized;\n\t}\n\n\treturn normalized;\n}\n\n/**\n * shuffles an array using the modern version of the Fisher–Yates shuffle\n * @param {Array} arr - the array to shuffle\n */\nfunction shuffle(arr) {\n\tlet i, j, tmp, newArr = [...arr];\n\tfor(i = newArr.length - 1; i > 0; i--) {\n\t\tj = Math.floor(Math.random() * (i + 1));\n\t\ttmp = newArr[i];\n\t\tnewArr[i] = newArr[j];\n\t\tnewArr[j] = tmp;\n\t}\n\treturn newArr;\n}\n\n/**\n * return a string representing the full type of the variable\n * @param {*} variable \n * @returns {String} - 'Object', 'Array', 'Number', 'String', 'Boolean', 'Null', 'Undefined', 'BigInt', 'Symbol', 'Date' ...\n */\nfunction realtypeof(variable) {\n\tlet rawType = Object.prototype.toString.call(variable); //[object Object], [object Array], [object Number] ...\n\treturn rawType.substring(8, rawType.length - 1);\n}\n\n/**\n * check if variable is a number or a string of a number\n * @param {*} variable \n */\nfunction isNumeric(variable) {\n\tif(typeof variable === 'string' && variable === '') return false;\n\telse return !isNaN(variable);\n}\n\nmodule.exports = exports = {\n\tstr2VarName: str2VarName,\n\tshuffle: shuffle,\n\trealtypeof: realtypeof,\n\tisNumeric: isNumeric\n};","/**\n * global variables and symbols\n */\n\"use strict\";\n\nmodule.exports = exports = {\n\tdefaultBasePermission: 0, /*default permission that all clients are automatically assigned to*/\n\tpermissionsKey: Symbol.for('permissions_property'), /*special key to get into the permissions when in the permission-tree nodes*/\n\tpath2nodeKey: Symbol.for('path2node_property'), /*special key for the path-to-node map that is at the root of a PermissionTree*/\n\tforceEventChangeKey: '__forceEventChangeKey' /*key for forcing a change on the proxy. this will be used to run code inside the change-loop*/\n};","\"use strict\"\n\nvar proxy2instance = new WeakMap();\nvar instance2proxy = new WeakMap();\n\nmodule.exports = exports = {\n\t/**\n\t * set a new entry of proxy->instance in the proxies map\n\t * @param {Proxy} proxy \n\t * @param {Object} instance \n\t */\n\tset: function(proxy, instance) {\n\t\tproxy2instance.set(proxy, instance);\n\t\tinstance2proxy.set(instance, proxy);\n\t},\n\t/**\n\t * get instance by proxy\n\t * @param {Proxy} proxy \n\t */\n\tgetInstance: function(proxy) {\n\t\treturn proxy2instance.get(proxy);\n\t},\n\t/**\n\t * get proxy by instance\n\t * @param {Object} instance \n\t */\n\tgetProxy: function(instance) {\n\t\treturn instance2proxy.get(instance);\n\t}\n};","/**\n * utilities for change-events\n */\n\"use strict\";\n\nconst { realtypeof } = require('./variables.js');\nconst { forceEventChangeKey } = require('../utils/globals.js');\nconst ohInstances = require('../classes/oh/instances.js');\n\nvar validChangeTypes = ['create','update','delete'];\n\n/**\n * check if received changes is a valid array of changes\n * @param {Array.<Change>} changes \n */\nfunction areValidChanges(changes) {\n\tif(!Array.isArray(changes) || changes.length === 0) {\n\t\treturn false;\n\t}\n\n\tfor(let change of changes) {\n\t\tif(typeof change.path !== 'string'\n\t\t|| !validChangeTypes.includes(change.type)\n\t\t|| (!change.hasOwnProperty('value') && change.type !== 'delete') /*create and update must have a 'value' property*/\n\t\t|| (!change.hasOwnProperty('oldValue') && change.type === 'update')) {/*update must have an 'oldValue' property*/\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * the change object as emitted from Proxserve\n * @typedef {Object} Change - each change emitted from Proxserve\n * @property {String} path - the path from the object listening to the property that changed\n * @property {*} value - the new value that was set\n * @property {*} oldValue - the previous value\n * @property {String} type - the type of change. may be - \"create\"|\"update\"|\"delete\"\n */\n/**\n * analyzes the changes before traversing them:\n * - extracting system reserved properties\n * - spreads an array of event-changes to a more verbose array of changes by transforming the\n *   creation of objects or arrays into individual changes of each property.\n * - comparing all possible permissions\n * @param {Array.<Change>} changes\n * @param {Object} oh\n * @param {Object} type - whether to compare required permissions of 'read' or 'write'\n * @param {Object} [digested] - already digested parts\n */\nfunction digest(changes, oh, type, digested) {\n\tif(!areValidChanges(changes)) {\n\t\tthrow new Error('Invalid changes were given');\n\t}\n\n\tlet isFirstIteration = false;\n\n\tif(typeof digested === 'undefined') { //happens only on the first iteration of the recursion\n\t\tisFirstIteration = true;\n\t\t\n\t\tdigested = {\n\t\t\tfilteredChanges: [],\n\t\t\tspreadedChanges: [],\n\t\t\tpermission: oh.permissionTree.get(changes[0].path),\n\t\t\trequiresDifferentPermissions: false\n\t\t};\n\t}\n\n\tfor(let i = 0; i < changes.length; i++) {\n\t\tlet change = changes[i];\n\n\t\tif(isFirstIteration) {\n\t\t\tif(change.path === `.${forceEventChangeKey}`) {\n\t\t\t\tif(change.type !== 'delete') {\n\t\t\t\t\tlet proxy = ohInstances.getProxy(oh);\n\t\t\t\t\tdelete proxy[forceEventChangeKey];\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdigested.filteredChanges.push(change);\n\t\t\t}\n\t\t}\n\t\t\n\t\t//check if permission is different between changes. inner changes will be check during the recursion\n\t\tif(digested.requiresDifferentPermissions === false) {\n\t\t\tlet currentPermission = oh.permissionTree.get(change.path);\n\t\t\tif(oh.permissionTree.compare(digested.permission, currentPermission, type) === false) {\n\t\t\t\tdigested.requiresDifferentPermissions = true;\n\t\t\t}\n\t\t}\n\n\t\tlet typeofchange = realtypeof(change.value);\n\n\t\tif((change.type === 'create' || change.type === 'update') && typeofchange === 'Object') {\n\t\t\tdigested.spreadedChanges.push({ path: change.path, type: change.type, oldValue: change.oldValue, value: {} }); //shallow change\n\n\t\t\tlet innerChanges = [];\n\t\t\tlet keys = Object.keys(change.value);\n\t\t\tfor(let key of keys) {\n\t\t\t\tinnerChanges.push({ path: `${change.path}.${key}`, type: 'create', oldValue: undefined, value: change.value[key] });\n\t\t\t}\n\t\t\t\n\t\t\tif(innerChanges.length > 0) {\n\t\t\t\tdigest(innerChanges, oh, type, digested);\n\t\t\t}\n\t\t}\n\t\telse if((change.type === 'create' || change.type === 'update') && typeofchange === 'Array') {\n\t\t\tdigested.spreadedChanges.push({ path: change.path, type: change.type, oldValue: change.oldValue, value: [] }); //shallow change\n\t\t\tlet innerChanges = [];\n\t\t\tfor(let i=0; i < change.value.length; i++) {\n\t\t\t\tinnerChanges.push({ path: `${change.path}[${i}]`, type: 'create', oldValue: undefined, value: change.value[i] });\n\t\t\t}\n\n\t\t\tif(innerChanges.length > 0) {\n\t\t\t\tdigest(innerChanges, oh, type, digested);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tdigested.spreadedChanges.push(change);\n\t\t}\n\t}\n\n\treturn digested;\n}\n\nmodule.exports = exports = {\n\tareValidChanges: areValidChanges,\n\tdigest: digest\n};","/**\n * Copyright 2020 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { simpleClone } from '../../node_modules/proxserve/general-functions.js';\nimport { simpleDeepEqual, xorChanges } from './functions.js';\nimport { areValidChanges } from '../../utils/change-events.js';\n\n/**\n * the change object as emitted from Proxserve\n * @typedef {Object} Change - each change emitted from Proxserve\n * @property {String} path - the path from the object listening to the property that changed\n * @property {*} value - the new value that was set\n * @property {*} oldValue - the previous value\n * @property {String} type - the type of change. may be - \"create\"|\"update\"|\"delete\"\n */\n\n//switch for debugging specific behaviors that are not harming or are fixed via one side (client or server)\n//those scripts are too important to delete but the debugging affects performance so it should stay shut down\nlet OH_DEBUG = false;\n\nclass OH {\n\tconstructor(domain, afterInitCallback, clientData = {}, proxserveOptions = {}) {\n\t\tthis.domain = domain;\n\t\tthis.id;\n\t\tthis.initiated = false;\n\t\tthis.changesQueue = {\n\t\t\tclient: [], /*the changes made by the client*/\n\t\t\tserver: [] /*the changes received from the server*/\n\t\t};\n\n\t\tthis.proxserveOptions = {\n\t\t\tdelay: (proxserveOptions.delay !== undefined) ? proxserveOptions.delay : 10,\n\t\t\tstrict: (proxserveOptions.strict !== undefined) ? proxserveOptions.strict : true,\n\t\t\temitReference: (proxserveOptions.emitReference !== undefined) ? proxserveOptions.emitReference : false\n\t\t};\n\t\t\n\t\tthis.socket = io(`/oh-${domain}`, {\n\t\t\tautoConnect: true,\n\t\t\treconnection: true,\n\t\t\tquery: { data: JSON.stringify(clientData) }\n\t\t});\n\n\t\tthis.socket.on('init', (data) => { //gets initiated with data from the server\n\t\t\tthis.id = data.id;\n\t\t\tif(data.obj) {\n\t\t\t\tthis.object = new Proxserve(data.obj, this.proxserveOptions);\n\t\t\t\tthis.object.on('change', this.onObjectChange.bind(this)); //when client alters the object\n\t\t\t\tthis.initiated = true;\n\t\t\t\tif(afterInitCallback) {\n\t\t\t\t\tafterInitCallback(this.object);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.socket.on('change', (changes) => {\n\t\t\tif(this.initiated) {\n\t\t\t\tthis.updateObject(changes);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * changes received from the server\n\t * @param {Array.<Change>} changes \n\t */\n\tupdateObject(changes) {\n\t\tif(areValidChanges(changes)) {\n\t\t\t//prevent infinite loop of:\n\t\t\t//client changes & notify server -> server changes & notify client -> client changes again & notify again..\n\t\t\tlet uniqueChanges = xorChanges(changes, this.changesQueue.client);\n\t\t\tthis.changesQueue.client = []; //check against client-made-changes should happen for only one cycle\n\t\t\tfor(let change of uniqueChanges) {\n\t\t\t\tthis.changesQueue.server.push(change); //save the change - value references might be altered later\n\t\t\t\tlet parts = Proxserve.splitPath(change.path);\n\t\t\t\tlet currObj = this.object;\n\n\t\t\t\twhile(typeof currObj[ parts[0] ] !== 'undefined' && parts.length > 1) {\n\t\t\t\t\tcurrObj = currObj[ parts.shift() ];\n\t\t\t\t}\n\n\t\t\t\tif(parts.length === 1) { //previous loop finished on time\n\t\t\t\t\tswitch(change.type) {\n\t\t\t\t\t\tcase 'create':\n\t\t\t\t\t\tcase 'update':\n\t\t\t\t\t\t\tif(OH_DEBUG && change.type === 'create' && typeof currObj[ parts[0] ] !== 'undefined') {\n\t\t\t\t\t\t\t\tconsole.warn('tried to create a new property but instead updated an existing one:');\n\t\t\t\t\t\t\t\tconsole.warn(change);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(!simpleDeepEqual(currObj[ parts[0] ], change.value)) {\n\t\t\t\t\t\t\t\t//update only if values are completely different. this helps avoid double asigning of new objects.\n\t\t\t\t\t\t\t\t//for example - the client sets a new object {a:1}, then updates the server which in turn updates the\n\t\t\t\t\t\t\t\t//client which will see that the local {a:1} is not the same reference as the server's {a:1}\n\t\t\t\t\t\t\t\tif(typeof change.value !== 'object') {\n\t\t\t\t\t\t\t\t\tcurrObj[ parts[0] ] = change.value;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t//don't point to original 'change.value' so later it will not get altered and then fail on 'xorChanges'\n\t\t\t\t\t\t\t\t\tcurrObj[ parts[0] ] = simpleClone(change.value);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'delete':\n\t\t\t\t\t\t\tdelete currObj[ parts[0] ];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error('couldn\\'t loop completely over path', change);\n\t\t\t\t}\n\n\t\t\t\tif(typeof change.reason === 'string' && change.reason.length >= 1) {\n\t\t\t\t\tconsole.warn(change.path, change.reason);\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\tconsole.error('changes received from server are not valid', changes);\n\t\t}\n\t}\n\n\t/**\n\t * changes made by the client\n\t * @param {Array.<Change>} changes \n\t */\n\tonObjectChange(changes) {\n\t\t//work on a copy of 'changes' in order not to change the reference of changes which is also used by client's listeners.\n\t\t//prevent infinite loop of:\n\t\t//server changes & notify client -> client changes & notify server -> server changes again & notify again..\n\t\tlet uniqueChanges = xorChanges(changes, this.changesQueue.server);\n\t\tthis.changesQueue.server = []; //check against server-changes should happen for only one cycle\n\n\t\tif(uniqueChanges.length >= 1) {\n\t\t\tthis.changesQueue.client = this.changesQueue.client.concat(uniqueChanges);\n\t\t\tthis.socket.emit('change', uniqueChanges);\n\t\t}\n\t}\n};\n\nmodule.exports = exports = OH; //makes ParcelJS expose this globally (for all platforms) after bundling everything"]}